<!DOCTYPE html>
<html>

	<head>

		<meta charset = "utf-8">
		<title>Pregled korisnika</title>
	
		<script type = "text/javascript" src = "js/jquery.js"></script>
		<script type = "text/javascript">

			function pregledKorisnika()
			{
				$.ajax({
					type: "GET",
					url: "dobaviTrenutnogKorisnika",
					data: 0,
					contentType: "application/json",
					dataType: "json",
					success: function(data)
					{
						if(data === false){
							alert("Morate biti ulogovani da biste pristupili ovoj stranici")
							location.href = "/index.html"
						}else if (data === 2){
							alert("Nemate pristup ovoj stranici")
							location.href = "/pregledVM.html"
						}else{
							var korisnik = data;
							ispisTabele(korisnik);
						}	
					}
				})
			}

			function ispisTabele(korisnik)
			{
				$.ajax({
					type: "GET",
					url: "dobaviKorisnike",
					data: 0,
					contentType: "application/json",
					dataType: "json",
					success: function(data)
					{
						if (korisnik === 0)
						{
							data.forEach(element => {
								$("#tabelaKorisnika").append($("<tr>")
														.append($("<td>")
															.text(element.korisnickoIme))
														.append($("<td>")
															.text(element.ime))
														.append($("<td>")
															.text(element.prezime))
														.append($("<td>")
															.text(element.organizacija.ime))
														.append($("<td>")
															.append($("<a>")
																.attr("href", "#")
																.attr("id", element.korisnickoIme)
																.attr("onclick", "izmeniKorisnika(this)")
																.text("Izmeni")))
														.append($("<td>")
															.append($("<a>")
																.attr("href", "#")
																.attr("id", element.korisnickoIme)
																.attr("onclick", "obrisiKorisnika(this)")
																.text("Obrisi")))			
													 )
							})
						}
						else if (korisnik === 1)
						{
							$("#organizacija").hide();
							data.forEach(element => {
								$("#tabelaKorisnika").append($("<tr>")
														.append($("<td>")
															.text(element.korisnickoIme))
														.append($("<td>")
															.text(element.ime))
														.append($("<td>")
															.text(element.prezime))
														.append($("<td>")
															.append($("<a>")
																.attr("href", "#")
																.attr("id", element.ime)
																.attr("onclick", "izmeniKorisnika(this)")
																.text("Izmeni")))
														.append($("<td>")
															.append($("<a>")
																.attr("href", "#")
																.attr("id", element.ime)
																.attr("onclick", "obrisiKorisnika(this)")
																.text("Obrisi")))			
													 )
							})
						}
					}
				})
			}

			function obrisiKorisnika(data){
			$("#tabelaKorisnika").find("tr").each(function()
			{
				var tds = $(this).find("td")
				if(tds.eq(0).text()==$(data).attr("id"))
				{
					$(this).empty()
				}
			})
			
			$.ajax
			({
				type: "POST",
				url: "obrisiKorisnika",
				data: $(data).attr("id"),
				success: function(data)
				{
				}
			})

			function izmeniKorisnika(data)
			{
				$.ajax
				({
					type : "POST",
					url: "izmeniKorisnika",
					data: $(data).attr("id"),
					success: function(data)
					{
						window.location.href = "izmenaKorisnika.html";
					}
				})
			}
		}

		</script>

	</head>
	
	<body onload = pregledKorisnika()>
		<h2>Korisnici</h2>
		
		<table border = "1" id = "tabelaKorisnika">
			<thead>
				<tr>
					<th>Korisnicko ime</th>
					<th>Ime</th>
					<th>Prezime</th>
					<th id = "organizacija">Organizacija</th>
					<th>Izmena</th>
					<th id = "brisanje">Brisanje</th>
				</tr>
			</thead>
		</table>
		
		<hr>
		<input id = "dodajKorisnika" type="button" value="Dodaj novog korisnika">
	</body>
	
</html>